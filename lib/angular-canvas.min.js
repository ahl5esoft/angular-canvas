window.$=_,angular.module("ac.util.strconv",[]).factory("acUtilStrconv",function(){var t=["t","true","y","yes","1","是"],e=function(t,e){try{return JSON.parse(t)}catch(i){return e}};return $.reduce(["array","bool","date","float","int","object"],function(t,e){return t[["to",e[0].toUpperCase(),e.substr(1)].join("")]=function(i){return t.to(e,i)},t},{to:function(i,n){switch(i){case"array":var r=e(n,[]);return $.isArray(r)?r:[];case"bool":return $.isBoolean(n)?n:$.isString(n)?$.indexOf(t,n.toLowerCase())>-1:!1;case"date":return new Date(n?Date.parse(n):0);case"float":return parseFloat(n)||0;case"int":return parseInt(n)||0;case"object":var a=e(n,{});return $.isObject(a)?a:{};default:return n}}})}),angular.module("ac.core.animation",[]).factory("acCoreAnimation",[function(){var t=[];return{FRAME:50,run:function(){$.each(t,function(t){t.index++,t.index<=t.max||(t.fn(),t.index=1)})},add:function(e,i){i||(i=50),t.push({fn:e,index:1,max:Math.ceil(i/this.FRAME)})},clear:function(){t=[]}}}]),angular.module("ac.core.context",["ac.core.animation"]).factory("acCoreContext",["$document","$interval","acCoreAnimation",function(t,e,i){var n,r=[];return{init:function(a,o){if(!n){var c=angular.element(['<canvas style="left: 0px; position: absolute; top: 0px; z-index: 0;" height="',o,'" width="',a,'">',"	您的浏览器不支持canvas","</canvas>"].join(""));t.find("body").append(c),$.each(["click","dblclick","mousemove"],function(t){c.bind(t,function(e){for(var i={isBubble:!0,name:t,x:e.x,y:e.y,stopBubbling:function(){this.isBubble=!1}},n=0,a=r.length;a>n&&(r[n].fire(i),!r[n].hit(i.x,i.y));n++);})}),n=c[0].getContext("2d"),e(function(){n.clearRect(0,0,a,o),i.run(),$.chain(r).select(function(t){return t.getDisplay()}).each(function(t){t.draw(n)})},1e3/i.FRAME)}},clear:function(){r=[]},add:function(t){r.push(t),r=$.sortBy(r,function(e){return-t.getZIndex()})}}}]),angular.module("ac.core.node",[]).factory("acCoreNode",["acUtilStrconv",function(t){function e(e,i,n){$.has(e._attributes,i)&&(e._attributes[i]=ATTR_MAP[i]?t.to(ATTR_MAP[i],n):n)}var i=function(){this._attributes={children:[],display:!0,id:"",over:!1,x:0,y:0,zIndex:0},this._events={}};i.prototype.extend=function(t){this._attributes=$.extend(this._attributes,t)},i.prototype.attr=function(){var t=Array.prototype.slice.call(arguments);if(1===t.length){if($.isString(t[0]))return this._attributes[t[0]];$.each(t[0],function(t,i){e(this,i,t)},this)}else 2===t.length&&e(this,t[0],t[1])},$.each(ATTR_MAP,function(t,n){i.prototype[["set",n[0].toUpperCase(),n.substr(1)].join("")]=function(t){e(this,n,t)},i.prototype[["get",n[0].toUpperCase(),n.substr(1)].join("")]=function(t){return this._attributes&&this._attributes[n]}}),i.prototype.show=function(){this.setDisplay(!0)},i.prototype.hide=function(){this.setDisplay(!1)},i.prototype.bind=function(t,e){this._events[t]=e},i.prototype.draw=function(t){$.chain(this.getChildren()).select(function(t){return t.getDisplay()}).sortBy(function(t){return-t.getZIndex()}).each(function(e){e.draw(t)})},i.prototype.fire=function(t){if(this.getDisplay()){var e=t.name;if("mousemove"===t.name)this.hit(t.x,t.y)?e="mouseover":this.getOver()&&(e="mouseout");else if(!this.hit(t.x,t.y))return;if(n(this,t),e!=t.name){switch(e){case"mouseover":if(this.getOver())return;this.setOver(!0);break;case"mouseout":this.setOver(!1)}t.name=e,n(this,t)}}};var n=function(t,e){var i=$.all(t.getChildren(),function(t){return t.fire(e),e.isBubble});i&&t._events[e.name]&&t._events[e.name](e)};return i.prototype.hit=function(t,e){return this.getDisplay()&&this.getWidth()&&this.getHeight()?this.getX()<=t&&t<=this.getX()+this.getWidth()&&this.getY()<=e&&e<=this.getY()+this.getHeight():!1},i.prototype.addChild=function(t){var e=this.getChildren();if(t.getId()){var i=$.any(e,function(e){return e.getId()===t.getId()});if(i)return}e.push(t),this.setChildren($.sortBy(e,function(e){return-t.getZIndex()}))},i}]);var ATTR_MAP={children:null,color:"string",display:"bool",height:"int",id:"string",image:null,lineWidth:"int",name:"string",over:"bool",sHeight:"int",size:"int",style:"string",sWidth:"int",sX:"int",sY:"int",text:"string",variant:"string",weight:"string",width:"int",x:"int",y:"int",zIndex:"int"};angular.module("ac.ui.image",[]).directive("acUiImage",[function(){return{require:"^acUiNode",restrict:"E",link:function(t,e,i,n){n.init({height:0,image:null,sHeight:0,sWidth:0,sX:0,sY:0,width:0},function(t){var e=this.getImage();if(e){var i=[e];this.getSHeight()&&i.push(this.getSX(),this.getSY(),this.getSWidth(),this.getSHeight());var n,r;this.getWidth()&&this.getHeight()?(n=this.getWidth(),r=this.getHeight()):(n=e.width,r=e.height),i.push(this.getX(),this.getY(),n,r),t.drawImage.apply(t,i)}})}}}]),angular.module("ac.ui.label",[]).directive("acUiLabel",[function(){return{require:"^acUiNode",restrict:"E",link:function(t,e,i,n){n.init({color:"rgb(0, 0, 0)",name:"微软雅黑",size:14,style:"normal",text:"",variant:"normal",weight:"normal"},function(t){this.getText()&&(t.font=[this.getStyle(),this.getVariant(),this.getWeight(),this.getSize()+"px",this.getName()].join(" "),t.fillStyle=this.getColor(),t.fillText(this.getText(),this.getX(),this.getY()+this.getSize()))})}}}]),angular.module("ac.ui.node",["ac.core.context","ac.util.strconv"]).directive("acUiNode",["acCoreContext","acCoreNode",function(t,e){return{controller:["$attrs",function(i){var n=new e;this.node=n,this.init=function(t,e){n.extend(t),e&&(n.draw=e)},"stage"===i.acUiNode?t.clear():t.add(n)}],compile:function(t,e){t.append(["<ac-ui-",e.acUiNode,"></ac-ui-",e.acUiNode,">"].join(""))}}}]),angular.module("ac.ui.rect",[]).directive("acUiRect",[function(){return{require:"^acUiNode",restrict:"E",link:function(t,e,i,n){n.init({color:"rgb(0, 0, 0)",height:0,lineWidth:0,width:0},function(t){if(this.getHeight()&&this.getWidth()){var e="fill";this.getLineWidth()&&(e="stroke",t.beginPath(),t.lineWidth=this.getLineWidth()),t.rect(this.getX(),this.getY(),this.getWidth(),this.getHeight()),t[e+"Style"]=this.getColor(),t[e]()}})}}}]),angular.module("ac.ui.stage",[]).directive("acUiStage",[function(){return{priority:10,require:"^acUiNode",restrict:"E",link:function(t,e,i,n){e.parent().remove()}}}]);var acAttr=angular.module("ac.attr.base",[]);$.each(ATTR_MAP,function(t,e){if(null!==t){var i=["acAttr",e[0].toUpperCase(),e.substr(1)].join("");acAttr.directive(i,function(){return{require:"?^acUiNode",link:function(t,n,r,a){t.$watch(r[i],function(t){a.node.attr(e,t)},1)}}})}}),angular.module("ac.attr.frame-image",["ac.core.animation","ac.util.strconv"]).directive("acAttrFrameImage",["acCoreAnimation","acUtilStrconv",function(t,e){return{require:"?^acUiNode",link:function(i,n,r,a){var o=0,c=0,s=e.toInt(r.x),u=e.toInt(r.y);i.$watch(n.attr("x-i"),function(t){o=s>t?t:0}),i.$watch(r.yIndex,function(t){c=u>t?t:0}),i.$watch(r.acAttrFrameImage,function(i){var n=new Image;n.src=i,n.onload=function(){var i=n.width/s,h=n.height/u;a.node.attr({image:n,sX:0,sY:0,sWidth:i,sHeight:h,width:i,height:h}),t.add(function(){a.node.attr({sX:o*i,sY:c*h}),c++,c>=u&&(c=0)},e.toInt(r.interval))}},1)}}}]),angular.module("ac.attr.hover-image",[]).directive("acAttrHoverImage",[function(){return{require:"?^acUiNode",link:function(t,e,i,n){t.$watch(i.acAttrHoverImage,function(t){var e=new Image,i=function(){n.node.attr({sX:0,sY:0})};e.src=t,e.onload=function(){n.node.attr({image:e,sWidth:e.width/2,sHeight:e.height,width:e.width/2,height:e.height}),n.node.bind("mouseover",function(){n.node.attr({sX:e.width/2,sY:0})}),n.node.bind("mouseout",i)},i()},1)}}}]),angular.module("ac.attr.image",[]).directive("acAttrImage",[function(){return{require:"?^acUiNode",link:function(t,e,i,n){t.$watch(i.acAttrImage,function(t){var e=new Image;e.src=t,e.onload=function(){n.node.setImage(e)}},1)}}}]),angular.module("ac",["ac.util.strconv","ac.core.animation","ac.core.context","ac.core.node","ac.ui.image","ac.ui.label","ac.ui.node","ac.ui.rect","ac.ui.stage","ac.attr.base","ac.attr.frame-image","ac.attr.hover-image","ac.attr.image"]);